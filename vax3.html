<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Poppins&display=swap");
      body {
        font-family: "Poppins", sans-serif;
        margin: 0;
        margin-left: 10px;
        padding: 0;
      }
      input,
      button,
      select {
        font-family: "Poppins", sans-serif;
      }
      #district {
        display: none;
      }
      select {
        width: 200px;
      }
      #datepicker {
        display: none;
        caret-color: transparent;
      }

      .vax-card {
        background: rgba(0, 151, 19, 0.3);
        border-radius: 20px;
        padding: 15px;
        margin-bottom: 15px;
        max-width: fit-content;
        margin-left: 10px;
      }
      h4 {
        display: inline;
        font-weight: bold;
      }
      p {
        display: inline;
      }
      .new_line {
        display: block;
        margin-bottom: 10px;
      }
      .green {
        color: #52c735;
      }
      button {
        display: none;
      }
    </style>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var state = document.getElementById("state");

        fetch("https://cdn-api.co-vin.in/api/v2/admin/location/states")
          .then((response) => response.json())
          .then((data) => {
            var states = data.states;
            //console.log(states);

            for (var i = 0; i < states.length; i++) {
              state.innerHTML += `<option value="${states[i].state_id}">${states[i].state_name}</option>`;
            }
          });

        //Getting states using dynamic id
        document.getElementById("state").onchange = function () {
          var value = document.getElementById("state").value;
          console.log(value);
          document.getElementById("district").options.length = 1;

          document.getElementById("district").style.display = "block";

          var url =
            "https://cdn-api.co-vin.in/api/v2/admin/location/districts/" +
            value;
          console.log(url);
          fetch(url)
            .then((response) => response.json())
            .then((data) => {
              var districts = data.districts;
              console.log(districts);
              for (var i = 0; i < districts.length; i++) {
                district.innerHTML += `<option value="${districts[i].district_id}">${districts[i].district_name}</option>`;
              }
            });
        };

        document.getElementById("district").onchange = function () {
          document.getElementById("datepicker").style.display = "block";
        };
      });
    </script>

    <!-- jQuery tags -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <link
      rel="stylesheet"
      href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css"
    />
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <!-- Date format Script -->
    <script type="text/javascript">
      $(function () {
        $("#datepicker").datepicker({ dateFormat: "dd/mm/yy" }).val();
        $("#datepicker").keydown(false);
      });
    </script>

    <!-- Final output -->

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        //getting dynamic vax cards

        document.getElementById("datepicker").onchange = function () {
          document.getElementById("search_button").style.display = "block";
        };

        document.getElementById("search_button").onclick = function () {
          document.getElementById("search_button").style.display = "block";
          document.querySelector(".cards-block").innerHTML = "";

          var date = document.getElementById("datepicker").value;
          var district_id = document.getElementById("district").value;
          // console.log(date);
          // console.log(district);

          var vaxCard = document.getElementById("vax-card");

          var url =
            "https://cdn-api.co-vin.in/api/v2/appointment/sessions/public/findByDistrict?district_id=" +
            district_id +
            "&date=" +
            date;

          fetch(url)
            // Put response into json form
            .then((response) => response.json())
            .then((data) => {
              // Log data to the console

              var sessions = data.sessions;

              console.log(sessions.length);
              let nearby_loc = document.createElement("h2");
              var loc = `
                        <h2>
                          Nearby Locations: 
                          <span class='green'>${sessions.length}</span>
                        </h2>
                      `;
              nearby_loc.innerHTML = loc;
              document.querySelector(".cards-block").appendChild(nearby_loc);

              for (var i = 0; i < sessions.length; i++) {
                let newCard = document.createElement("div");
                newCard.classList.add("vax-card");
                var row = `   
                    <div class="new_line">
                      <h4>Name: </h4><p>${sessions[i].name}</p>
                    </div>

                    <div class="new_line">
                      <h4>Vaccine: </h4><p>${sessions[i].vaccine}</p>
                    </div>

                    <div class="new_line">
                      <h4>Fee Type: </h4><p>${sessions[i].fee_type}</p>
                    </div>

                    <div class="new_line">
                      <h4>Fee: </h4><p>RS.${sessions[i].fee}</p>
                    </div>
                    
                    <div class="new_line">
                      <h4>Available Capacity: </h4><p>${sessions[i].available_capacity}</p>
                    </div>
        
                  `;
                newCard.innerHTML = row;
                document.querySelector(".cards-block").appendChild(newCard);
              }
            });
        };
      });
    </script>

    <title>Document</title>
  </head>
  <body>
    <select name="state" id="state" required>
      <option value="NONE" disabled selected>Select State</option>
    </select>
    <select name="district" id="district" required>
      <option value="NONE" disabled selected>Select District</option>
    </select>

    <input
      type="text"
      id="datepicker"
      size="10"
      placeholder="Select Date"
      required
    />
    <button id="search_button" aria-readonly="true">Search Vaccine</button>
    <div class="cards-block"></div>
  </body>
</html>
